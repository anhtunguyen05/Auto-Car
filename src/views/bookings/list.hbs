<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Booking Management</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="/bookings/add" class="btn btn-primary">
            <i class="bi bi-calendar-plus"></i> Create New Booking
        </a>
    </div>
</div>

<div class="row mb-3">
    <div class="col-md-8">
        <form class="d-flex" method="GET" action="/bookings" id="searchForm">
            <input class="form-control me-2" type="search" name="search" placeholder="Search bookings..." value="{{search}}">
            <button class="btn btn-outline-primary" type="submit">
                <i class="bi bi-search"></i> Search
            </button>
        </form>
    </div>
    <div class="col-md-4">
        <select class="form-select" id="filterStatus" onchange="filterByStatus(this.value)">
            <option value="" {{#unless status}}selected{{/unless}}>All Status</option>
            <option value="PENDING" {{#if (eq status 'PENDING')}}selected{{/if}}>Pending</option>
            <option value="CONFIRMED" {{#if (eq status 'CONFIRMED')}}selected{{/if}}>Confirmed</option>
            <option value="COMPLETED" {{#if (eq status 'COMPLETED')}}selected{{/if}}>Completed</option>
            <option value="CANCELLED" {{#if (eq status 'CANCELLED')}}selected{{/if}}>Cancelled</option>
        </select>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Booking ID</th>
                <th>Customer</th>
                <th>Car</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Total Price</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{#each bookings}}
            <tr>
                <td><strong>#{{this._id}}</strong></td>
                <td>
                    <div>
                        <div>{{this.userId.name}}</div>
                        <small class="text-muted">{{this.userId.email}}</small>
                    </div>
                </td>
                <td>
                    <strong>{{this.carId.brand}} {{this.carId.model}}</strong><br>
                    <small class="text-muted">{{this.carId.licensePlate}}</small>
                </td>
                <td>{{formatDate this.startDate}}</td>
                <td>{{formatDate this.endDate}}</td>
                <td><strong>${{this.totalCost}}</strong></td>
                <td>
                    <span class="badge bg-{{statusColor this.status}}">{{this.status}}</span>
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <a href="/bookings/{{this._id}}" class="btn btn-outline-info" title="View">
                            <i class="bi bi-eye"></i>
                        </a>
                        {{#if (eq this.status 'PENDING')}}
                        <form method="POST" action="/bookings/{{this._id}}/confirm" style="display: inline;">
                            <button type="submit" class="btn btn-outline-success" title="Confirm">
                                <i class="bi bi-check-circle"></i>
                            </button>
                        </form>
                        {{/if}}
                        {{#if (eq this.status 'CONFIRMED')}}
                        <form method="POST" action="/bookings/{{this._id}}/complete" style="display: inline;">
                            <button type="submit" class="btn btn-outline-primary" title="Complete">
                                <i class="bi bi-check-all"></i>
                            </button>
                        </form>
                        {{/if}}
                        {{#unless (eq this.status 'CANCELLED')}}
                        {{#unless (eq this.status 'COMPLETED')}}
                        <form method="POST" action="/bookings/{{this._id}}/cancel" style="display: inline;" onsubmit="return confirm('Are you sure you want to cancel this booking?');">
                            <button type="submit" class="btn btn-outline-danger" title="Cancel">
                                <i class="bi bi-x-circle"></i>
                            </button>
                        </form>
                        {{/unless}}
                        {{/unless}}
                    </div>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="8" class="text-center py-4">
                    <i class="bi bi-inbox fs-1 text-muted"></i>
                    <p class="text-muted">No bookings found</p>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>

{{#if pagination}}
<nav>
    <ul class="pagination justify-content-center">
        <li class="page-item {{#unless pagination.hasPrev}}disabled{{/unless}}">
            <a class="page-link" href="?page={{pagination.prevPage}}">Previous</a>
        </li>
        {{#each pagination.pages}}
        <li class="page-item {{#if this.active}}active{{/if}}">
            <a class="page-link" href="?page={{this.number}}">{{this.number}}</a>
        </li>
        {{/each}}
        <li class="page-item {{#unless pagination.hasNext}}disabled{{/unless}}">
            <a class="page-link" href="?page={{pagination.nextPage}}">Next</a>
        </li>
    </ul>
</nav>
{{/if}}
