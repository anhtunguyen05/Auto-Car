<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">User Management</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="/users/add" class="btn btn-primary">
            <i class="bi bi-person-plus"></i> Add New User
        </a>
    </div>
</div>

<div class="row mb-3">
    <div class="col-md-8">
        <form class="d-flex" method="GET" action="/users">
            <input class="form-control me-2" type="search" name="search" placeholder="Search users..." value="{{search}}">
            <button class="btn btn-outline-primary" type="submit">
                <i class="bi bi-search"></i> Search
            </button>
        </form>
    </div>
    <div class="col-md-4">
        <select class="form-select" id="filterRole" onchange="filterByRole(this.value)">
            <option value="" {{#unless role}}selected{{/unless}}>All Roles</option>
            <option value="ADMIN" {{#if (eq role 'ADMIN')}}selected{{/if}}>Admin</option>
            <option value="CUSTOMER" {{#if (eq role 'CUSTOMER')}}selected{{/if}}>Customer</option>
            <option value="OWNER" {{#if (eq role 'OWNER')}}selected{{/if}}>Owner</option>
        </select>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Role</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{#each users}}
            <tr>
                <td>
                    <strong>{{this.name}}</strong>
                </td>
                <td>{{this.email}}</td>
                <td>{{this.phone}}</td>
                <td><span class="badge bg-{{roleColor this.role}}">{{this.role}}</span></td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <a href="/users/{{this._id}}" class="btn btn-outline-info" title="View">
                            <i class="bi bi-eye"></i>
                        </a>
                        <a href="/users/edit/{{this._id}}" class="btn btn-outline-primary" title="Edit">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <button onclick="deleteUser('{{this._id}}')" class="btn btn-outline-danger" title="Delete">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="5" class="text-center py-4">
                    <i class="bi bi-inbox fs-1 text-muted"></i>
                    <p class="text-muted">No users found</p>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>

{{#if pagination}}
<nav>
    <ul class="pagination justify-content-center">
        <li class="page-item {{#unless pagination.hasPrev}}disabled{{/unless}}">
            <a class="page-link" href="?page={{pagination.prevPage}}">Previous</a>
        </li>
        {{#each pagination.pages}}
        <li class="page-item {{#if this.active}}active{{/if}}">
            <a class="page-link" href="?page={{this.number}}">{{this.number}}</a>
        </li>
        {{/each}}
        <li class="page-item {{#unless pagination.hasNext}}disabled{{/unless}}">
            <a class="page-link" href="?page={{pagination.nextPage}}">Next</a>
        </li>
    </ul>
</nav>
{{/if}}
